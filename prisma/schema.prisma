generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Course {
  id                String       @id
  name              String
  description       String
  shortDescription  String
  startDate         DateTime
  endDate           DateTime
  capacity          Int
  enrolled          Int
  category          String
  level             String
  modality          String
  prerequisites     String // Se guarda como "js,html,css"
  imageUrl          String
  creatorId         String
  modules           Module[]
  enrollments       Enrollment[]
  instructors       CourseInstructor[]
  tasks             Task[]
}

model Module {
  id          String @id
  name        String
  description String
  url         String
  order       Int
  course      Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  courseId    String
}

model Enrollment {
  id             String   @id
  userId         String
  course         Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  courseId       String
  enrollmentDate DateTime

  @@map("course_student")
}

model CourseInstructor {
  id       String   @id @default(uuid())
  course   Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  courseId String
  userId   String
  type     InstructorType

  @@unique([courseId, userId]) // para que no se repita el mismo instructor en un curso
  @@map("courses_instructors")
}

// Enum para los tipos de instructor
enum InstructorType {
  TITULAR
  AUXILIAR
}

model Task {
  id                   String       @id @default(uuid())
  course_id            String
  created_by           String
  type                 TaskType
  title                String
  description          String
  instructions         String
  due_date             DateTime
  allow_late           Boolean
  late_policy          LatePolicy
  has_timer            Boolean
  time_limit_minutes   Int? // opcional
  published            Boolean
  visible_from         DateTime?
  visible_until        DateTime?
  allow_file_upload    Boolean
  answer_format        AnswerFormat
  created_at           DateTime     @default(now())
  updated_at           DateTime     @updatedAt
  deleted_at           DateTime?

  // Relaciones
  course               Course       @relation(fields: [course_id], references: [id], onDelete: Cascade)

  @@map("tasks")
}

enum TaskType {
  tarea
  examen
}

enum LatePolicy {
  ninguna
  descontar
  penalizar
  aceptar
  aceptar_con_descuento
  aceptar_con_penalizacion
}

enum AnswerFormat {
  texto
  opcion_multiple
  archivo
  mixto
}